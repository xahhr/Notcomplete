<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ØªØ¹Ø§ÙÙŠ 63 â€“ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (Ù…ÙØµØ­Ø­ 100%)</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
body{font-family:'Cairo',sans-serif;background:#f8f9fa;color:#222;margin:0;padding:20px;line-height:1.7}
.container{max-width:900px;margin:auto;background:#fff;padding:30px;border-radius:20px;box-shadow:0 10px 40px rgba(0,0,0,0.1)}
h1{text-align:center;background:linear-gradient(90deg,#2ecc71,#3498db);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-size:36px}
table{width:100%;border-collapse:collapse;margin:30px 0;font-size:17px}
th{background:#e8f5e9;padding:15px}
td{padding:15px;text-align:center;border-bottom:1px solid #ddd}
.btn{padding:12px 24px;background:#2ecc71;color:#fff;border:none;border-radius:12px;cursor:pointer;font-size:16px}
.btn:hover{background:#27ae60}
dialog{background:#fff;padding:30px;border-radius:16px;border:none;box-shadow:0 15px 50px rgba(0,0,0,0.3);max-width:600px;width:90%}
dialog::backdrop{background:#00000099}
input, select{padding:10px;border-radius:8px;border:1px solid #ccc;width:100%;margin:8px 0}
</style>
</head>
<body>

<div class="container">
  <h1>Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ ğŸ“¦ â€“ ØªØ¹Ø§ÙÙŠ 63</h1>
  <p style="text-align:center;font-size:19px;margin:20px 0">
    Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø®Ø·Ø©: <b><span id="startDate">28 Ù†ÙˆÙÙ…Ø¨Ø± 2025</span></b> â”‚ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ: <b><span id="today"></span></b>
  </p>

  <table id="stockTable">
    <thead>
      <tr>
        <th>Ø§Ù„Ø¯ÙˆØ§Ø¡</th>
        <th>Ù…Ø¬Ù… / Ù‚Ø±Øµ</th>
        <th>Ø£Ù‚Ø±Ø§Øµ / Ø¹Ù„Ø¨Ø©</th>
        <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù„Ø¨</th>
        <th>Ø£Ù‚Ø±Ø§Øµ Ù…ÙØ±Ø¯Ø©</th>
        <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‚Ø±Ø§Øµ</th>
        <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø¬Ù…</th>
        <th>Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</th>
        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div style="text-align:center;margin:40px 0">
    <button class="btn" id="editBtn">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† âœï¸</button>
  </div>
</div>

<dialog id="editDialog">
  <h2 style="text-align:center">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h2>
  <div id="form"></div>
  <div style="text-align:left;margin-top:30px">
    <button class="btn" style="background:#e74c3c" onclick="document.getElementById('editDialog').close()">Ø¥Ù„ØºØ§Ø¡</button>
    <button class="btn" id="saveBtn">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª âœ…</button>
  </div>
</dialog>

<script>
// Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø© 100%
const drugs = [
  {key:"eso", name:"Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ†", mg:3, tabsPerBox:30},
  {key:"gab", name:"Ø¬Ø§Ø¨Ø§Ø¨Ù†ØªÙŠÙ†", mg:800, tabsPerBox:30},
  {key:"arm", name:"Ø£Ø±Ù…ÙˆØ¯Ø§ÙÙŠÙ†ÙŠÙ„", mg:150, tabsPerBox:30}
];

const LS_INV = "t63_inventory_v2";

// ØªØ­Ù…ÙŠÙ„ Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø®Ø²ÙˆÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠ
function getStock(){
  let stock = JSON.parse(localStorage.getItem(LS_INV));
  if(!stock){
    stock = {
      eso: {boxes:5, loose:0},
      gab: {boxes:3, loose:0},
      arm: {boxes:2, loose:0}
    };
    localStorage.setItem(LS_INV, JSON.stringify(stock));
  }
  return stock;
}

// Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø®Ø·Ø©
function calculateDaysLeft(key, totalMg){
  const targets = {
    eso: [15,15,15,15,15,15,15,14,14,14,14,14,14,14,14,14,14,14,14,12,12,12,12,12,12,12,10,10,10,10,10,10,10,8,8,8,8,8,8,8,6,6,6,6,6,6,6,4,4,4,4,4,4,4,2,2,2,1,1,1,0],
    gab: [2200,2200,2200,2200,2200,2200,2200,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,1800,1800,1800,1800,1800,1600,1600,1600,1600,1600,1600,1600,1400,1400,1400,1400,1400,1400,1400,1200,1200,1200,1200,1200,1200,1200,1000,1000,1000,1000,1000,1000,1000,800,800,800,800,800,800,800,600,600,600,300,300,300,0],
    arm: [650,650,650,650,650,650,650,600,600,600,600,600,600,600,600,600,600,600,600,550,550,550,550,550,500,500,500,500,500,500,500,400,400,400,400,400,400,400,300,300,300,300,300,300,300,200,200,200,200,200,200,200,100,100,100,100,100,100,100,50,50,50,0,0,0,0]
  };

  let currentDay = getCurrentDay();
  let needed = 0;
  for(let d = currentDay-1; d < 63; d++){
    needed += targets[key][d] || 0;
  }
  return needed === 0 ? "âˆ" : Math.max(0, Math.floor(totalMg / needed * (63-currentDay+1)));
}

function getCurrentDay(){
  const start = new Date("2025-11-28");
  const diff = Date.now() - start.getTime();
  const day = Math.floor(diff / 86400000) + 1;
  return Math.min(63, Math.max(day, 1));
}

function renderTable(){
  const stock = getStock();
  const tbody = document.querySelector("#stockTable tbody");
  tbody.innerHTML = "";
  let allGood = true;

  drugs.forEach(d => {
    const cur = stock[d.key];
    const totalTabs = cur.boxes * d.tabsPerBox + cur.loose;
    const totalMg = totalTabs * d.mg;
    const daysLeft = calculateDaysLeft(d.key, totalMg);

    if(daysLeft < 10 && daysLeft !== "âˆ") allGood = false;

    const row = document.createElement("tr");
    row.innerHTML = `
      <td><b>${d.name}</b></td>
      <td>${d.mg} Ù…Ø¬Ù…</td>
      <td>${d.tabsPerBox} Ù‚Ø±Øµ</td>
      <td>${cur.boxes} Ø¹Ù„Ø¨Ø©</td>
      <td>${cur.loose} Ù‚Ø±Øµ</td>
      <td><b>${totalTabs}</b></td>
      <td><b>${totalMg.toLocaleString()}</b> Ù…Ø¬Ù…</td>
      <td><b>${daysLeft}</b></td>
      <td style="font-size:28px">${daysLeft<10 && daysLeft!=="âˆ" ? "âš ï¸ Ù‚Ø±Ø¨ Ø§Ù„Ù†ÙØ§Ø¯" : "âœ…"}</td>
    `;
    tbody.appendChild(row);
  });

  document.getElementById("today").textContent = new Date().toLocaleDateString('ar-EG');
}

// Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
document.getElementById("editBtn").onclick = () => {
  const stock = getStock();
  let html = "";
  drugs.forEach(d => {
    const cur = stock[d.key];
    html += `
      <div style="margin:20px 0;padding:20px;background:#f8f9fa;border-radius:12px">
        <h3>${d.name} (${d.mg} Ù…Ø¬Ù… â€“ ${d.tabsPerBox} Ù‚Ø±Øµ/Ø¹Ù„Ø¨Ø©)</h3>
        <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù„Ø¨: <input type="number" value="${cur.boxes}" data-key="${d.key}" data-field="boxes"></label><br>
        <label>Ø£Ù‚Ø±Ø§Øµ Ù…ÙØ±Ø¯Ø© Ø¥Ø¶Ø§ÙÙŠØ©: <input type="number" value="${cur.loose}" data-key="${d.key}" data-field="loose"></label>
      </div>
    `;
  });
  document.getElementById("form").innerHTML = html;
  document.getElementById("editDialog").showModal();
};

// Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
document.getElementById("saveBtn").onclick = () => {
  const stock = {};
  document.querySelectorAll("#form input").forEach(inp => {
    const key = inp.dataset.key;
    const field = inp.dataset.field;
    if(!stock[key]) stock[key] = {};
    stock[key][field] = Number(inp.value) || 0;
  });
  localStorage.setItem(LS_INV, JSON.stringify(stock));
  document.getElementById("editDialog").close();
  renderTable();
  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨Ù†Ø¬Ø§Ø­ âœ…");
};

renderTable();
</script>
</body>
</html>
