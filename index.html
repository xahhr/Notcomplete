<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ØªØ¹Ø§ÙÙŠ 63 â€“ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
body{font-family:'Cairo',sans-serif;background:#f8f9fa;color:#222;margin:0;line-height:1.6}
header{background:#fff;padding:16px;box-shadow:0 2px 10px rgba(0,0,0,0.1);position:sticky;top:0;z-index:10}
h1{font-size:24px;margin:0;background:linear-gradient(90deg,#2ecc71,#3498db);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.wrap{max-width:1100px;margin:auto;padding:12px}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
.card{grid-column:span 12;background:#fff;border-radius:16px;padding:20px;box-shadow:0 4px 20px rgba(0,0,0,0.08)}
@media(min-width:900px){.half{grid-column:span 6}}
.btn{padding:10px 16px;border:none;border-radius:12px;cursor:pointer;margin:4px;font-size:14px}
.btn.a{background:#2ecc71;color:#fff}.btn.w{background:#f39c12;color:#fff}
.pill{padding:6px 14px;border-radius:30px;background:#e8f5e9;font-size:13px;display:inline-flex;align-items:center;gap:6px}
.bar{height:10px;background:#eee;border-radius:5px;overflow:hidden;margin:10px 0}
.bar span{display:block;height:100%;background:linear-gradient(90deg,#3498db,#2ecc71);transition:0.5s}
.table{width:100%;border-collapse:collapse;font-size:14px}
.table th{background:#f0f8ff;padding:12px}
.table td{padding:10px;text-align:center;border-bottom:1px solid #eee}
.tip{background:#e8f5ff;padding:16px;border-radius:12px;border-right:5px solid #3498db;margin:12px 0;font-size:15px}
.mood{padding:12px 20px;border-radius:30px;background:#f0f0f0;cursor:pointer;transition:.3s}
.mood.active{background:#d5f5e3;border:2px solid #2ecc71}
#chart{height:220px !important}
dialog{background:#fff;padding:25px;border-radius:16px;border:none;box-shadow:0 10px 40px rgba(0,0,0,0.3);max-width:90%;width:500px}
dialog::backdrop{background:#00000099}
input[type=number]{padding:8px;border-radius:8px;border:1px solid #ddd;width:80px}
</style>
</head>
<body>

<header>
  <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px">
    <h1>ØªØ¹Ø§ÙÙŠ 63 ğŸŒ¿ â€“ Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ† 15â†’0 Ù…Ø¬Ù…</h1>
    <div>
      <button class="btn" id="openInv">Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ğŸ“¦</button>
      <button class="btn" id="prevDay">â¬… Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
      <button class="btn" id="nextDay">Ø§Ù„ØªØ§Ù„ÙŠ â¡</button>
      <button class="btn w" id="resetStart">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ğŸ“…</button>
      <button class="btn a" id="saveDay">Ø­ÙØ¸ Ø§Ù„ÙŠÙˆÙ… âœ…</button>
    </div>
  </div>
  <div style="margin-top:12px;display:flex;gap:12px;flex-wrap:wrap;align-items:center">
    <span class="pill">Ø¨Ø¯Ø¡: <b id="startDateLabel"></b></span>
    <span class="pill">ÙŠÙˆÙ… <b id="dayIdxLabel">1</b>/63</span>
    <span class="pill">Ø£Ø³Ø¨ÙˆØ¹ <b id="weekLabel">1</b></span>
    <span class="pill" style="background:#d5f5e3">ØªÙ‚Ø¯Ù… <b id="progressText">0%</b></span>
    <div class="bar" style="flex:1"><span id="progressBar" style="width:0%"></span></div>
  </div>
</header>

<div class="wrap"><div class="grid">

  <div class="card"><h3>Ù…Ù†Ø­Ù†Ù‰ Ø§Ù„Ø§Ù†Ø³Ø­Ø§Ø¨ ğŸ“‰</h3><canvas id="chart"></canvas></div>

  <div class="card"><h3>Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ… ğŸ¯</h3><p id="targetsText" style="font-size:19px;font-weight:600"></p></div>

  <div class="card">
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª</h3>
    <table class="table">
      <tr><th>Ø§Ù„Ø¯ÙˆØ§Ø¡</th><th>Ø§Ù„Ù‡Ø¯Ù</th><th>Ø£ÙØ®Ø°</th></tr>
      <tr><td>Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ†</td><td id="t_eso">15</td><td><input type="number" step="0.5" data-k="eso"></td></tr>
      <tr><td>Ø¬Ø§Ø¨Ø§Ø¨Ù†ØªÙŠÙ†</td><td id="t_gab">2200</td><td><input type="number" step="100" data-k="gab"></td></tr>
      <tr><td>Ø£Ø±Ù…ÙˆØ¯Ø§ÙÙŠÙ†ÙŠÙ„</td><td id="t_arm">650</td><td><input type="number" step="50" data-k="arm"></td></tr>
      <tr><td>ÙƒØ§ÙÙŠÙŠÙ† â‰¤</td><td id="t_caf">350</td><td><input type="number" step="10" data-k="caf"></td></tr>
    </table>
  </div>

  <div class="card"><h3>Ù†ØµÙŠØ­Ø© Ø§Ù„ÙŠÙˆÙ… ğŸ’¡</h3><div id="dailyTip" class="tip"></div></div>

  <div class="card half">
    <h3>Ù…Ø²Ø§Ø¬Ùƒ</h3>
    <div style="display:flex;gap:12px;justify-content:center;margin:20px 0">
      <span class="mood" onclick="setMood(1)">ğŸ˜”</span>
      <span class="mood" onclick="setMood(2)">ğŸ˜°</span>
      <span class="mood active" onclick="setMood(3)">ğŸ˜</span>
      <span class="mood" onclick="setMood(4)">ğŸ™‚</span>
      <span class="mood" onclick="setMood(5)">ğŸ˜</span>
    </div>
    <textarea id="notes" rows="4" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙŠÙˆÙ…..."></textarea>
  </div>

  <div class="card">
    <h3>Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ğŸ“¦</h3>
    <table class="table" id="invTable"><tbody></tbody></table>
  </div>

</div></div>

<dialog id="invDlg">
  <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>
  <div id="invForm"></div>
  <div style="margin-top:20px;text-align:left">
    <button class="btn" onclick="document.getElementById('invDlg').close()">Ø¥Ù„ØºØ§Ø¡</button>
    <button class="btn a" id="saveInv">Ø­ÙØ¸</button>
  </div>
</dialog>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const TOTAL_DAYS = 63;
const LS_START = "t63_start", LS_DATA = "t63_data", LS_INV = "t63_inv_v3";
let currentDay = 1, currentMood = 3, chart = null;

// Ø§Ù„Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Ù†ÙØ³ Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù„ÙƒÙ† Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØµØ­ÙŠØ­Ø©)
const targets = {
  eso: [0,15,15,15,15,15,15,15,14,14,14,14,14,14,14,14,14,14,14,14,12,12,12,12,12,12,12,10,10,10,10,10,10,10,8,8,8,8,8,8,8,6,6,6,6,6,6,6,4,4,4,4,4,4,4,2,2,2,1,1,1,0],
  gab: [0,2200,2200,2200,2200,2200,2200,2200,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,1800,1800,1800,1800,1800,1600,1600,1600,1600,1600,1600,1600,1400,1400,1400,1400,1400,1400,1400,1200,1200,1200,1200,1200,1200,1200,1000,1000,1000,1000,1000,1000,1000,800,800,800,800,800,800,800,600,600,600,300,300,300,0],
  arm: [0,650,650,650,650,650,650,650,600,600,600,600,600,600,600,600,600,600,600,600,550,550,550,550,550,500,500,500,500,500,500,500,400,400,400,400,400,400,400,300,300,300,300,300,300,300,200,200,200,200,200,200,200,100,100,100,100,100,100,100,50,50,50,0,0,0,0],
  caf: [0,350,350,350,350,350,350,350,300,300,300,300,300,300,300,300,300,300,300,300,250,250,250,250,250,200,200,200,200,200,200,200,150,150,150,150,150,150,150,100,100,100,100,100,100,100,75,75,75,75,75,75,75,50,50,50,50,50,50,50,30,30,30,10,10,10,0]
};

// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø©
const drugInfo = {
  eso: {name:"Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ†", mg:3, tabsPerBox:30},
  gab: {name:"Ø¬Ø§Ø¨Ø§Ø¨Ù†ØªÙŠÙ†", mg:800, tabsPerBox:30},
  arm: {name:"Ø£Ø±Ù…ÙˆØ¯Ø§ÙÙŠÙ†ÙŠÙ„", mg:150, tabsPerBox:30}
};

const tips = ["Ø§Ø´Ø±Ø¨ 4 Ù„ØªØ± Ù…Ø§Ø¡","Ù…ØºÙ†ÙŠØ³ÙŠÙˆÙ… Ø¬Ù„Ø§ÙŠØ³ÙŠÙ†Ø§Øª 400 Ù…Ø¬Ù… Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…","20 Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ø´ÙŠ","Ù„Ø§ ÙƒØ§ÙÙŠÙŠÙ† Ø¨Ø¹Ø¯ 2 Ø¸Ù‡Ø±Ù‹Ø§","Ø­Ù…Ø§Ù… Ø¯Ø§ÙØ¦ + Ù…Ù„Ø­ Ø¥Ø¨Ø³ÙˆÙ…","ØªÙ†ÙØ³ 4-7-8","Ø£ÙˆÙ…ÙŠØ¬Ø§-3 Ø¹Ø§Ù„ÙŠ EPA","Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù†ÙˆÙ… Ø«Ø§Ø¨ØªØ©","Ù„-Ø«ÙŠØ§Ù†ÙŠÙ† 200-400 Ù…Ø¬Ù…","ÙƒÙˆÙŠØªØ§Ø¨ÙƒØ³ 25 ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø¶Ø±ÙˆØ±Ø©"];

function getStartDate(){let s=localStorage.getItem(LS_START);if(!s){let d=new Date();d.setHours(0,0,0,0);localStorage.setItem(LS_START,d.toISOString());s=d.toISOString()}return new Date(s)}
function getCurrentDay(){let diff=Date.now()-getStartDate().getTime();return Math.min(TOTAL_DAYS,Math.max(1,Math.floor(diff/86400000)+1))}
function loadDayData(d){let a=JSON.parse(localStorage.getItem(LS_DATA)||"{}");return a[d]||{med:{},mood:3,notes:""}}
function saveDayData(d,o){let a=JSON.parse(localStorage.getItem(LS_DATA)||"{}");a[d]=o;localStorage.setItem(LS_DATA,JSON.stringify(a))}

function renderChart(){/* Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ */ if(chart)chart.destroy(); chart=new Chart(document.getElementById('chart'),{type:'line',data:{labels:Array.from({length:TOTAL_DAYS},(_,i)=>i+1),datasets:[{label:'Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ†',data:targets.eso.slice(1),borderColor:'#e74c3c',tension:0.4},{label:'Ø¬Ø§Ø¨Ø§Ø¨Ù†ØªÙŠÙ†',data:targets.gab.slice(1).map(x=>x/100),borderColor:'#f39c12',tension:0.4},{label:'Ø£Ø±Ù…ÙˆØ¯Ø§ÙÙŠÙ†ÙŠÙ„',data:targets.arm.slice(1),borderColor:'#3498db',tension:0.4}]},options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}},maintainAspectRatio:false}});}

function render(){/* ÙƒÙ„ Ø§Ù„Ù€ render Ø§Ù„Ø³Ø§Ø¨Ù‚ */ currentDay=getCurrentDay(); /* Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ Ù†ÙØ³ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù…Ø¹ ØªØºÙŠÙŠØ± stim â†’ arm */ document.getElementById("t_arm").textContent=targets.arm[currentDay]; document.getElementById("targetsText").innerHTML=`Ø¥ÙŠØ²ÙˆØ¨ÙŠÙƒÙ„ÙˆÙ† <b>${targets.eso[currentDay]}</b> â€¢ Ø¬Ø§Ø¨Ø§Ø¨Ù†ØªÙŠÙ† <b>${targets.gab[currentDay]}</b> â€¢ Ø£Ø±Ù…ÙˆØ¯Ø§ÙÙŠÙ†ÙŠÙ„ <b>${targets.arm[currentDay]}</b> â€¢ ÙƒØ§ÙÙŠÙŠÙ† â‰¤ <b>${targets.caf[currentDay]}</b>`; renderChart(); renderInventory();}

function renderInventory(){
  let inv = JSON.parse(localStorage.getItem(LS_INV)||"{}");
  if(Object.keys(inv).length===0){
    inv = {eso:{boxes:5,loose:0}, gab:{boxes:3,loose:0}, arm:{boxes:2,loose:0}};
    localStorage.setItem(LS_INV,JSON.stringify(inv));
  }
  const tbody = document.querySelector("#invTable tbody"); tbody.innerHTML="";
  Object.keys(drugInfo).forEach(k=>{
    const i = drugInfo[k];
    const cur = inv[k];
    const totalTabs = cur.boxes * i.tabsPerBox + cur.loose;
    const totalMg = totalTabs * i.mg;
    let needed=0;
    for(let d=currentDay; d<=TOTAL_DAYS; d++) needed += targets[k][d];
    const daysLeft = needed===0 ? "âˆ" : Math.floor(totalMg / needed * (TOTAL_DAYS-currentDay+1));
    const row=document.createElement("tr");
    row.innerHTML=`<td><b>${i.name}</b></td><td>${totalTabs} Ù‚Ø±Øµ</td><td>${daysLeft} ÙŠÙˆÙ…</td><td style="font-size:22px">${daysLeft<10 && daysLeft!=="âˆ" ? "âš ï¸" : "âœ…"}</td>`;
    tbody.appendChild(row);
  });
}

/* Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù†ÙØ³ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù…Ø¹ ØªØºÙŠÙŠØ± stim â†’ arm ÙÙŠ ÙƒÙ„ Ù…ÙƒØ§Ù† */
document.getElementById("openInv").onclick = () => { /* Ù†ÙØ³ ÙƒÙˆØ¯ ÙØªØ­ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù…Ø¹ drugInfo Ø§Ù„Ø¬Ø¯ÙŠØ¯ */ };
document.getElementById("saveInv").onclick = () => { /* Ù†ÙØ³ ÙƒÙˆØ¯ Ø§Ù„Ø­ÙØ¸ */ };

render();
setInterval(()=>{if(getCurrentDay()!==currentDay) render();},60000);
</script>
</body>
</html>
